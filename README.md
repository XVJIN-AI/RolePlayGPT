# 🎭 角色扮演聊天机器人

一个支持多角色切换的智能聊天机器人系统，可以与5个经典影视文学角色进行真实对话。

## ✨ 功能特点

- 🎯 **多角色系统**：支持5个不同风格的经典角色
  - 🔍 夏洛克·福尔摩斯 - 睿智的侦探
  - 🦾 托尼·斯塔克 - 幽默的科技天才
  - 🐒 孙悟空 - 豪迈的齐天大圣
  - 🎐 诸葛亮 - 儒雅的智者
  - ⚡ 哈利·波特 - 勇敢的年轻巫师

- 💬 **智能对话**：基于GPT-4o模型，保持角色人设一致性
- 🎨 **美观界面**：暗色主题，流畅动画，优秀的用户体验
- 💰 **费用统计**：实时显示Token消耗和费用明细
- 💾 **历史保存**：支持导出对话历史为JSON文件
- 🔄 **自由切换**：随时在不同角色间切换对话

## 📋 环境要求

- Python 3.8+
- OpenAI API Key
- 稳定的网络连接

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置环境变量

**Windows:**
```cmd
set OPENAI_API_KEY=your_api_key_here
set OPENAI_BASE_URL=your_base_url_here
```

**Linux/Mac:**
```bash
export OPENAI_API_KEY=your_api_key_here
export OPENAI_BASE_URL=your_base_url_here
```

### 3. 启动应用

**方式一：使用启动脚本**

Windows:
```cmd
run.bat
```

Linux/Mac:
```bash
chmod +x run.sh
./run.sh
```

**方式二：直接运行**
```bash
streamlit run app.py
```

### 4. 访问应用

浏览器自动打开，或手动访问：`http://localhost:8501`

## 📖 使用指南

1. **选择角色**：在左侧边栏点击任意角色按钮
2. **查看信息**：展开"查看角色详情"了解角色背景
3. **开始对话**：在底部输入框输入消息并发送
4. **监控消耗**：侧边栏实时显示Token使用和费用
5. **保存记录**：点击"保存对话历史"导出聊天内容
6. **切换角色**：随时点击其他角色开始新的对话
7. **清空对话**：点击"清空对话"重置当前会话

## 🎬 角色介绍

### 🔍 夏洛克·福尔摩斯
- **来源**：《福尔摩斯探案集》
- **特点**：高智商侦探，冷静理性，善于推理
- **风格**：精准简洁，喜欢演绎推理

### 🦾 托尼·斯塔克
- **来源**：漫威电影宇宙
- **特点**：科技天才，幽默风趣，自信洒脱
- **风格**：轻松幽默，充满创造力

### 🐒 孙悟空
- **来源**：《西游记》
- **特点**：齐天大圣，豪迈洒脱，重情重义
- **风格**：直率豪爽，自称"俺老孙"

### 🎐 诸葛亮
- **来源**：《三国演义》
- **特点**：智慧超群，谨慎稳重，儒雅谦逊
- **风格**：文雅含蓄，引经据典

### ⚡ 哈利·波特
- **来源**：《哈利·波特》系列
- **特点**：勇敢善良，忠诚正直，富有正义感
- **风格**：真诚直接，充满勇气

## 📁 项目结构

```
final_lab/
├── app.py              # 主程序入口
├── characters.py       # 角色配置
├── utils.py           # 工具函数
├── requirements.txt   # 依赖列表
├── requirement.txt    # 实验要求
├── README.md          # 项目说明
├── report.md          # 技术报告
├── run.bat            # Windows启动脚本
├── run.sh             # Linux/Mac启动脚本
├── .streamlit/
│   └── config.toml    # Streamlit配置
└── chat_history/      # 对话历史（自动生成）
```

## 💡 技术特点

- **角色一致性**：通过详细的系统提示词确保AI始终保持角色设定
- **上下文管理**：维护完整对话历史，确保对话连贯性
- **精确计费**：基于API返回的实际Token数计算费用
- **性能优化**：合理的温度参数和Token限制，平衡效果和成本
- **用户体验**：流畅的动画效果和直观的操作界面

## 📊 费用说明

本项目使用OpenAI的gpt-4o-ca模型，计费标准：
- 输入Token：$0.000005/token
- 输出Token：$0.000015/token

应用会实时显示Token消耗和预估费用，帮助您控制成本。

## 🔧 技术栈

- **前端框架**：Streamlit 1.28.0
- **AI模型**：OpenAI GPT-4o-ca
- **API客户端**：openai 1.3.0
- **Token计数**：tiktoken 0.5.1

## 📝 开发说明

详细的技术实现和问题解决方案请参考 [report.md](report.md)

## 🤝 贡献

欢迎提出建议和改进意见！

## 📄 许可

本项目仅用于学习和演示目的。

## ⚠️ 注意事项

1. 请确保正确设置环境变量
2. 注意控制对话长度以避免过多Token消耗
3. 定期保存重要的对话历史
4. 切换角色会自动清空当前对话历史

---

**享受与经典角色的对话之旅！** 🎭✨
